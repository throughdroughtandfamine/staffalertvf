local config = {
    group_ids = {866697749},
    notification_duration = 5,

    join_color = Color3.fromRGB(255, 50, 50),
    leave_color = Color3.fromRGB(50, 255, 50),
    list_color = Color3.fromRGB(255, 255, 100),

    staff_list_key = Enum.KeyCode.F4,

    -- Staff override IDs (people that have in-game whitelist or similar)
    extra_staff_ids = {
        [6203233210] = true,
        [4559062275] = true,
        [1675953525] = true,
        [555909464] = true,
        [43829894] = true,
    },

    announce_existing_on_exec = true,
}

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")

_G.__StaffTracker = _G.__StaffTracker or {}
if _G.__StaffTracker.connections then
    for _, c in ipairs(_G.__StaffTracker.connections) do
        pcall(function() c:Disconnect() end)
    end
end
_G.__StaffTracker.connections = {}

local knownStaff = {}
local staffCache = {}

local function is_staff(plr)
    if config.extra_staff_ids[plr.UserId] then
        staffCache[plr.UserId] = true
        return true
    end

    local cached = staffCache[plr.UserId]
    if cached ~= nil then
        return cached
    end

    for _, groupId in ipairs(config.group_ids) do
        local ok, inGroup = pcall(function()
            return plr:IsInGroup(groupId)
        end)
        if ok and inGroup then
            staffCache[plr.UserId] = true
            return true
        end
    end

    staffCache[plr.UserId] = false
    return false
end

local function display_name(plr)
    if plr.DisplayName ~= plr.Name then
        return string.format("%s (@%s)", plr.DisplayName, plr.Name)
    end
    return plr.Name
end

local function build_gui()
    local player = Players.LocalPlayer
    local playerGui = player:WaitForChild("PlayerGui")

    local old = playerGui:FindFirstChild("staff_notifications")
    if old then old:Destroy() end

    local gui = Instance.new("ScreenGui")
    gui.Name = "staff_notifications"
    gui.ResetOnSpawn = false
    gui.Parent = playerGui

    local holder = Instance.new("Frame")
    holder.BackgroundTransparency = 1
    holder.AnchorPoint = Vector2.new(0.5, 0)
    holder.Position = UDim2.new(0.5, 0, 0, 40)
    holder.Size = UDim2.new(0, 520, 1, -40)
    holder.Parent = gui

    local layout = Instance.new("UIListLayout")
    layout.Padding = UDim.new(0, 6)
    layout.Parent = holder

    return holder
end

local holder = build_gui()

local function show_notification(text, color)
    local label = Instance.new("TextLabel")
    label.BackgroundTransparency = 1
    label.Size = UDim2.new(1, 0, 0, 36)
    label.Text = text
    label.TextColor3 = color
    label.TextScaled = true
    label.Font = Enum.Font.Oswald

    local stroke = Instance.new("UIStroke")
    stroke.Thickness = 1.5
    stroke.Transparency = 0.3
    stroke.Parent = label

    label.Parent = holder

    task.spawn(function()
        task.wait(config.notification_duration)
        for i = 0, 1, 0.08 do
            if not label.Parent then return end
            label.TextTransparency = i
            stroke.Transparency = math.clamp(0.3 + i, 0, 1)
            task.wait(0.03)
        end
        if label.Parent then label:Destroy() end
    end)
end

local function notify_join(plr)
    show_notification(display_name(plr) .. " joined", config.join_color)
end

local function notify_leave(plr)
    show_notification(display_name(plr) .. " left", config.leave_color)
end

local function get_staff_list()
    local staffPlayers = {}
    for _, plr in ipairs(Players:GetPlayers()) do
        if knownStaff[plr.UserId] then
            table.insert(staffPlayers, plr)
        end
    end

    table.sort(staffPlayers, function(a, b)
        return a.Name:lower() < b.Name:lower()
    end)

    local out = {}
    for _, plr in ipairs(staffPlayers) do
        table.insert(out, display_name(plr))
    end
    return out
end

for _, plr in ipairs(Players:GetPlayers()) do
    if is_staff(plr) then
        knownStaff[plr.UserId] = true
        notify_join(plr)
    end
end

table.insert(_G.__StaffTracker.connections,
    Players.PlayerAdded:Connect(function(plr)
        task.wait(0.5)
        if is_staff(plr) and not knownStaff[plr.UserId] then
            knownStaff[plr.UserId] = true
            notify_join(plr)
        end
    end)
)

table.insert(_G.__StaffTracker.connections,
    Players.PlayerRemoving:Connect(function(plr)
        if knownStaff[plr.UserId] then
            knownStaff[plr.UserId] = nil
            notify_leave(plr)
        end
    end)
)

table.insert(_G.__StaffTracker.connections,
    UserInputService.InputBegan:Connect(function(input, processed)
        if processed then return end
        if input.KeyCode ~= config.staff_list_key then return end

        local staff_list = get_staff_list()
        show_notification(("Staff in server: %d"):format(#staff_list), config.list_color)

        if #staff_list == 0 then
            show_notification("No staff in server", config.list_color)
            return
        end

        task.wait(0.2)
        show_notification("--- STAFF LIST ---", config.list_color)
        task.wait(0.15)

        for _, name in ipairs(staff_list) do
            show_notification(name, config.list_color)
            task.wait(0.1)
        end
    end)
)







